fahsai.bus.ku.ac.th {
  encode zstd gzip

  handle_path /phpmyadmin* { reverse_proxy phpmyadmin:80 }
  @pma_assets { path /js* /themes* /favicon.ico /robots.txt
                header Referer *fahsai.bus.ku.ac.th/phpmyadmin* }
  handle @pma_assets { reverse_proxy phpmyadmin:80 }

  # Strapi ทั้ง API/Admin ใต้ /strapi
  handle_path /strapi* { reverse_proxy strapi:1337 }

  # Next.js ที่เหลือทั้งหมด (รวม /admin ของ Next.js)
  handle { reverse_proxy nextjs:3000 }

  header {
    Strict-Transport-Security "max-age=31536000"
    X-Content-Type-Options "nosniff"
    X-XSS-Protection "1; mode=block"
    X-Frame-Options "DENY"
    -Server
  }
}
